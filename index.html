<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Coliber ðŸŒŸ</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  font-family:'Vazirmatn',sans-serif;
  background: linear-gradient(135deg,#101020,#1c1c36);
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
}
#chat {
  width:90%;
  max-width:700px;
  height:70vh;
  background: rgba(0,0,0,0.35);
  overflow:auto;
  padding:20px;
  border-radius:16px;
  margin-bottom:12px;
  box-shadow:0 10px 25px rgba(0,0,0,0.7);
}
.msg {
  margin:10px 0;
  padding:14px 18px;
  border-radius:16px;
  max-width:80%;
  line-height:1.6;
  word-break:break-word;
  opacity:0;
  transform:translateY(12px);
  transition: all .3s ease;
}
.msg.show { opacity:1; transform:translateY(0); }
.user { margin-left:auto; background: linear-gradient(90deg,#022b3a,#03506f); color:#e0ffff; }
.bot { margin-right:auto; background: linear-gradient(90deg,#2b1b3f,#6835a0); color:#fff; }
#inputArea { width:90%; max-width:700px; display:flex; gap:10px; }
input[type="text"] {
  flex:1;
  padding:14px;
  border-radius:12px;
  border:none;
  background: rgba(0,0,0,0.4);
  color:#fff;
  font-size:16px;
}
button { padding:14px 20px; border-radius:12px; border:none; background:#4caf50; color:#fff; font-weight:700; cursor:pointer; }
.typing { display:flex; gap:8px; align-items:center; padding:10px 14px; border-radius:14px; background: rgba(255,255,255,0.05); width:110px; }
.dot { width:10px; height:10px; background:#fff; border-radius:50%; opacity:0.35; animation: blink 1s infinite; }
.dot:nth-child(2){ animation-delay: .15s }
.dot:nth-child(3){ animation-delay: .3s }
@keyframes blink { 0%{opacity:.15}50%{opacity:1}100%{opacity:.15} }
</style>
</head>
<body>

<div id="chat"></div>
<div id="inputArea">
<input type="text" id="inp" placeholder="Ù¾ÛŒØ§Ù…ØªÙˆ Ø¨Ù†ÙˆÛŒØ³ Ùˆ Enter Ø¨Ø²Ù†">
<button id="send">Ø§Ø±Ø³Ø§Ù„</button>
</div>

<script>
// ----- Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù†Ù…ÙˆÙ†Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ -----
const knowledgeBase = [
  {type:'greeting', patterns:['Ø³Ù„Ø§Ù…','Ø¯Ø±ÙˆØ¯','hi','hello'], response:'Ø³Ù„Ø§Ù…! ðŸŒŸ Ù…Ù† Coliber Ù‡Ø³ØªÙ…. Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ'},
  {type:'reply', patterns:['Ú†Ø·ÙˆØ±ÛŒ','Ø®ÙˆØ¨ÛŒ','Ø­Ø§Ù„ØŸ'], response:'Ù…Ø±Ø³ÛŒ! Ù…Ù† Ø¹Ø§Ù„ÛŒ Ù‡Ø³ØªÙ… ðŸ˜Š ØªÙˆ Ú†Ø·ÙˆØ±ÛŒØŸ'},
  {type:'science', patterns:['Ú©ÙˆØ§Ù†ØªÙˆÙ…','ÙÛŒØ²ÛŒÚ©','Ø±ÛŒØ§Ø¶ÛŒ','Ø´ÛŒÙ…ÛŒ','Ø²ÛŒØ³Øª','Ù†Ø¬ÙˆÙ…'], response:'Ø§ÛŒÙ† Ù…ÙˆØ¶ÙˆØ¹ Ø¹Ù„Ù…ÛŒ Ø§Ø³Øª Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… ØªÙˆØ¶ÛŒØ­ Ø¯Ù‚ÛŒÙ‚ Ø¨Ø¯Ù‡Ù….'},
  {type:'math', patterns:['Ø¬Ù…Ø¹','ØªÙØ±ÛŒÙ‚','Ø¶Ø±Ø¨','ØªÙ‚Ø³ÛŒÙ…','Ø­Ù„ Ù…Ø¹Ø§Ø¯Ù„Ù‡','Ù…Ø«Ù„Ø«Ø§Øª','Ø§Ù†ØªÚ¯Ø±Ø§Ù„'], response:'Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ú¯Ø§Ù… Ø¨Ù‡ Ú¯Ø§Ù… ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡Ù… Ùˆ Ù…Ø«Ø§Ù„ Ø¨Ø²Ù†Ù….'},
  {type:'history', patterns:['ØªØ§Ø±ÛŒØ®','Ø§Ù†Ù‚Ù„Ø§Ø¨','Ø§ÛŒØ±Ø§Ù†','Ø¬Ù‡Ø§Ù†'], response:'Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø´Ø±Ø­ ØªØ§Ø±ÛŒØ®ÛŒ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø¨Ø¯Ù‡Ù….'},
  {type:'anime', patterns:['Ù†Ø§Ø±ÙˆØªÙˆ','ÙˆØ§Ù† Ù¾ÛŒØ³','Ø¨Ù„ÛŒÚ†','Ø¬ÙˆØ¬ÙˆØªØ³Ùˆ','Ø´ÛŒØ·Ø§Ù† Ú©Ø´'], response:'Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¯Ø§Ø³ØªØ§Ù† Ùˆ Ø´Ø®ØµÛŒØªâ€ŒÙ‡Ø§ Ø±Ø§ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡Ù….'},
  {type:'capital', patterns:['Ø§ÛŒØ±Ø§Ù†','ÙØ±Ø§Ù†Ø³Ù‡','Ø§Ù†Ú¯Ù„ÛŒØ³','Ú˜Ø§Ù¾Ù†','Ø¢Ù…Ø±ÛŒÚ©Ø§','Ø¢Ù„Ù…Ø§Ù†'], response:'Ø§ÛŒÙ† Ú©Ø´ÙˆØ± Ù¾Ø§ÛŒØªØ®Øª Ù…Ø¹Ø±ÙˆÙÛŒ Ø¯Ø§Ø±Ø¯.'},
  {type:'slang', patterns:['Ù„Ø¹Ù†Øª','Ø®Ø±','Ù…Ø³Ø®Ø±Ù‡','Ø§Ø­Ù…Ù‚'], response:'ðŸ˜… Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØªØ±Ù…Ø§Ù†Ù‡ ØµØ­Ø¨Øª Ú©Ù†!'},
  {type:'creative', patterns:['Ø³Ø§Ø®Øª Ø¯Ø§Ø³ØªØ§Ù†','Ú©Ø¯Ù†ÙˆÛŒØ³ÛŒ','ÙØ§ÛŒÙ„','Ù¾Ø±ÙˆÚ˜Ù‡','ÙˆÛŒØ±Ø§ÛŒØ´'], response:'Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ù…ØªÙ†ØŒ Ø¯Ø§Ø³ØªØ§Ù†ØŒ Ú©Ø¯ Ùˆ ÙØ§ÛŒÙ„ Ø¨Ø³Ø§Ø²Ù….'},
  {type:'learned', patterns:[], response:''} 
];

let conversationMemory = JSON.parse(localStorage.getItem('coliberMemory') || '[]');

const chat = document.getElementById('chat');
const inp = document.getElementById('inp');

function addMsg(txt,cls,typing=false){
  const d=document.createElement('div');
  d.className='msg '+cls;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
  if(!typing){ d.innerText=txt; d.classList.add('show'); return; }
  let i=0;
  const showNext=()=>{i++; d.innerText=txt.slice(0,i); if(!d.classList.contains('show')) d.classList.add('show'); chat.scrollTop=chat.scrollHeight; if(i<txt.length)setTimeout(showNext,5);}
  showNext();
}

function showTypingIndicator(){
  const t=document.createElement('div');
  t.className='msg bot typing';
  t.innerHTML='<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
  chat.appendChild(t); chat.scrollTop=chat.scrollHeight;
  return t;
}

function findResponse(msg){
  msg = msg.toLowerCase();
  for(let item of knowledgeBase){
    for(let pat of item.patterns){
      if(msg.includes(pat.toLowerCase())) return item.response;
    }
  }
  return null;
}

function learnAutomatically(msg){
  msg = msg.trim();
  let exists = knowledgeBase.some(item => item.patterns.some(p => msg.includes(p)));
  if(!exists){
    if(msg.includes('Ù¾Ø§ÛŒØªØ®Øª') && msg.split(' ').length>=3){
      let parts = msg.split(' ');
      let country = parts[1];
      let capital = parts[2];
      knowledgeBase.push({type:'capital', patterns:[country], response:capital});
      console.log('ÛŒØ§Ø¯ Ú¯Ø±ÙØªÙ…:', country,'=>',capital);
    } else {
      knowledgeBase.push({type:'learned', patterns:[msg], response:msg});
      console.log('ÛŒØ§Ø¯ Ú¯Ø±ÙØªÙ… Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯:', msg);
    }
  }
}

// ----- Text-to-Speech -----
function speak(text){
  if(!('speechSynthesis' in window)) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'fa-IR';
  utter.pitch = 1;
  utter.rate = 1;
  window.speechSynthesis.speak(utter);
}

function sendMsg(){
  const val = inp.value.trim(); if(!val) return;
  addMsg(val,'user'); inp.value='';

  learnAutomatically(val);

  const typingNode = showTypingIndicator();

  setTimeout(()=>{
    let answer = findResponse(val);
    if(!answer){
      const similar = conversationMemory.find(c=>val.includes(c.user.toLowerCase()));
      answer = similar ? similar.bot : 'Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…! ðŸ˜Š Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ù†Ù‡: Â«'+val+'Â»';
    }

    conversationMemory.push({user:val, bot:answer});
    localStorage.setItem('coliberMemory', JSON.stringify(conversationMemory));

    if(typingNode && typingNode.parentNode) typingNode.parentNode.removeChild(typingNode);
    addMsg(answer,'bot',true);

    // Ù¾Ø®Ø´ ÙˆÛŒØ³ Ù¾Ø§Ø³Ø®
    speak(answer);
  },300);
}

document.getElementById('send').onclick=sendMsg;
inp.addEventListener('keydown',e=>{ if(e.key==='Enter') sendMsg(); });

addMsg('Ø³Ù„Ø§Ù…! Ù…Ù† Coliber Ù‡Ø³ØªÙ… ðŸŒŸ Ø¢Ù…Ø§Ø¯Ù‡ Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒØŒ Ø®Ù„Ù‚ Ù…Ø­ØªÙˆØ§ Ùˆ ØªÙˆÙ„ÛŒØ¯ ÙˆÛŒØ³!','bot');
</script>

</body>
</html>
